{% extends 'core/base.html' %}

{% block head_title %}ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ±ÙÙŠ{% endblock %}

{% block head_extra %}
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-12">
    <!-- Header Section -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-primary mb-2">ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</h1>
        <p class="text-muted">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
    </div>

    <!-- Account Summary Card -->
    <div class="max-w-4xl mx-auto mb-8">
        <div class="card rounded-2xl p-6">
            <div class="grid md:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-light rounded-xl">
                    <p class="text-sm text-muted mb-1">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                    <p class="text-xl font-bold text-primary">{{ account.account_no }}</p>
                </div>
                <div class="text-center p-4 bg-beige rounded-xl">
                    <p class="text-sm text-muted mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                    <p class="text-xl font-bold text-primary">{{ account.account_type.name }}</p>
                </div>
                <div class="text-center p-4 bg-light rounded-xl">
                    <p class="text-sm text-muted mb-1">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                    <p class="text-2xl font-bold text-primary">${{ account.balance }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="max-w-2xl mx-auto mb-8">
        <div class="card rounded-xl p-6">
            <h3 class="text-lg font-medium text-primary mb-4">ØªØµÙÙŠØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
            <form method="get" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-primary mb-2">Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <div class="relative">
                        <input type="search" 
                               name="daterange" 
                               id="search" 
                               placeholder="Ø§Ø®ØªØ± Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®" 
                               value="{{ request.GET.daterange }}" 
                               class="input-field w-full px-4 py-3 rounded-xl text-gray-700 leading-tight focus:outline-none" />
                        <button type="submit" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted hover:text-primary">
                            <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="w-5 h-5">
                                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </button>
                    </div>
                    {% if form.daterange.errors %}
                        {% for error in form.daterange.errors %}
                            <p class="text-red-600 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ©
                    </button>
                    <a href="{% url 'transactions:transaction_report' %}" class="btn-secondary px-6 py-2 rounded-lg font-medium">
                        Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ©
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Transactions Table -->
    <div class="max-w-6xl mx-auto">
        <div class="card rounded-xl overflow-hidden">
            <div class="bg-primary text-white p-4">
                <h3 class="text-lg font-medium">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
            </div>
            
            {% if object_list %}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-light">
                        <tr class="text-primary">
                            <th class="px-6 py-4 text-right font-medium">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</th>
                            <th class="px-6 py-4 text-right font-medium">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                            <th class="px-6 py-4 text-right font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th class="px-6 py-4 text-right font-medium">Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in object_list %}
                        <tr class="border-b border-gray-100 hover:bg-light transition-colors duration-200">
                            <td class="px-6 py-4">
                                {% if transaction.transaction_type == 1 %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                        Ø¥ÙŠØ¯Ø§Ø¹
                                    </span>
                                {% elif transaction.transaction_type == 2 %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        Ø³Ø­Ø¨
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        ÙØ§Ø¦Ø¯Ø©
                                    </span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 text-muted">
                                {{ transaction.timestamp|date:"Y/m/d H:i" }}
                            </td>
                            <td class="px-6 py-4 font-medium">
                                {% if transaction.transaction_type == 1 %}
                                    <span class="text-green-600">+${{ transaction.amount }}</span>
                                {% else %}
                                    <span class="text-red-600">-${{ transaction.amount }}</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 font-bold text-primary">
                                ${{ transaction.balance_after_transaction }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="bg-beige">
                        <tr>
                            <th class="px-6 py-4 text-right text-primary" colspan="3">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                            <th class="px-6 py-4 text-right text-2xl font-bold text-primary">
                                ${{ account.balance }}
                            </th>
                        </tr>
                    </tfoot>
                </table>
            </div>
            {% else %}
            <div class="p-12 text-center">
                <div class="text-6xl text-muted mb-4">ğŸ“Š</div>
                <h3 class="text-xl font-medium text-primary mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                <p class="text-muted mb-6">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                <div class="space-x-4 space-x-reverse">
                    <a href="{% url 'transactions:deposit_money' %}" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        Ø¥ÙŠØ¯Ø§Ø¹ Ø£Ù…ÙˆØ§Ù„
                    </a>
                    <a href="{% url 'transactions:withdraw_money' %}" class="btn-secondary px-6 py-2 rounded-lg font-medium">
                        Ø³Ø­Ø¨ Ø£Ù…ÙˆØ§Ù„
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="max-w-2xl mx-auto mt-8">
        <div class="card rounded-xl p-6">
            <h3 class="text-lg font-medium text-primary mb-4">Ø¹Ù…Ù„ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
            <div class="grid md:grid-cols-3 gap-4">
                <a href="{% url 'transactions:deposit_money' %}" class="btn-primary text-center py-3 px-4 rounded-lg font-medium">
                    Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø¯ÙŠØ¯
                </a>
                <a href="{% url 'transactions:withdraw_money' %}" class="btn-secondary text-center py-3 px-4 rounded-lg font-medium">
                    Ø³Ø­Ø¨ Ø£Ù…ÙˆØ§Ù„
                </a>
                <a href="{% url 'home' %}" class="btn-secondary text-center py-3 px-4 rounded-lg font-medium">
                    Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer_extra %}
    <script type="text/javascript">
        $(function () {
            $('input[name="daterange"]').daterangepicker({
                autoUpdateInput: false,
                locale: {
                    cancelLabel: "Ù…Ø³Ø­",
                    applyLabel: "ØªØ·Ø¨ÙŠÙ‚",
                    format: "YYYY-MM-DD",
                    separator: " - ",
                    customRangeLabel: "Ù†Ø·Ø§Ù‚ Ù…Ø®ØµØµ",
                    daysOfWeek: ["Ø£Ø­", "Ø¥Ø«", "Ø«", "Ø£Ø±", "Ø®", "Ø¬", "Ø³"],
                    monthNames: ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"],
                    firstDay: 6
                },
            });

            $('input[name="daterange"]').on("apply.daterangepicker", function (ev, picker) {
                $(this).val(picker.startDate.format("YYYY-MM-DD") + " - " + picker.endDate.format("YYYY-MM-DD"));
            });

            $('input[name="daterange"]').on("cancel.daterangepicker", function (ev, picker) {
                $(this).val("");
            });
        });
    </script>
{% endblock %}